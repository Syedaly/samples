Stage	Task	Resource/Technology	Using Lambda	Using EC2	Notes/Cost Analysis
1. File Storage	Store CSV files in S3	S3	Files stored in a landing S3 bucket.	Files stored in a landing S3 bucket.	S3 charges apply equally for both setups. Lifecycle policies can help manage costs for long-term storage.
2. Schema Management	Schema creation for Iceberg	Athena (Iceberg Table)	Run Athena queries manually or automate using Terraform to create schemas.	Run Athena queries manually or automate using Terraform to create schemas.	Automating schema creation with Terraform simplifies workflows and ensures reproducibility.
3. Data Ingestion	Pick files, ingest data into Iceberg table, partition, convert	Lambda or EC2, Python/Boto3	Use Lambda to pick files, validate schema, and run SQL insert queries via Athena. Handles small files effectively but may timeout for larger files (>1GB).	Use EC2 to run the same Python script without timeout issues. Ideal for larger files or batch processing.	Lambda: Limited to 15 min, cost-effective for small files.
EC2: More suitable for larger files or bulk operations, with higher compute costs but no timeout.
4. Partitioning	Partition data in Iceberg table	Iceberg/Athena Partitioning	Iceberg automatically handles partitioning during data ingestion.	Iceberg automatically handles partitioning during data ingestion.	Iceberg's built-in partitioning saves the need for separate Glue jobs or ETL tools, reducing operational complexity.
5. Automation	Automate file ingestion and schema validation	Terraform, Lambda/EC2, GitOps	Terraform automates deployment of Lambda functions, triggers, and Athena tables.	Terraform automates deployment of EC2 instances, triggers, and Athena tables.	GitOps ensures code and infrastructure changes are versioned and auditable.
6. Monitoring	Monitor ingestion and execution	CloudWatch	Use CloudWatch to monitor Lambda execution logs and alerts for failures.	Use CloudWatch to monitor EC2 logs, execution metrics, and alerts for failures.	Monitoring costs depend on data ingested and retention policies.
7. Validation	Validate successful ingestion	Athena Queries, CloudWatch	Validate data ingestion by querying Iceberg tables via Athena.	Validate data ingestion by querying Iceberg tables via Athena.	Validation steps are common to both setups.
8. Cost Comparison	Operational cost of processing	S3, Athena, Lambda/EC2	- Lambda Costs: $0.20 per million requests + compute time ($0.00001667/GB-second for 1GB).	- EC2 Costs: Dependent on instance type (e.g., $0.096/hour for t3.medium or $0.48/hour for c5.large).	Lambda is cost-effective for smaller files.
EC2 is better suited for long-running jobs.
